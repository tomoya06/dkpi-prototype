## 引言

### 研究背景

物联网（The Internet of Things, IoT）技术在现实世界的应用非常广泛，并呈现出爆炸式增长的态势，智能设备的自主交互将成为未来智能系统的核心应用技术。据估计，在未来四年内将有逾10亿新的智能设备上线、相互传输超过44ZB（Zettabyte, 1ZB=10^21bytes）的数据[1]。

如此大规模的设备网络也促使人们寻找一种更安全、更快速的方案来完成物联网设备的识别、交互、数据传输等任务[4]。物联网设备的识别依靠的是每台设备独一无二的数字身份，设备间的交互和数据传输都基于每台设备独有的数字身份来完成，所以对一个物联网体系而言，如何管理和维护设备的数字身份，就是衡量这个平台安全性的关键因素。

当今的物联网设备大多依托中心化的系统来完成数字身份的管理，例如笔者将在后面介绍的阿里云物联网平台。中心化物联网系统提供的解决方案是：由系统中心、即某一物联网平台的运营团体，来统一负责物联网设备数字身份的管理，比如身份签发、验证、撤销、存储等，设备的操作指令和事件监听的定义需事先在平台上注册，设备之间的信息交互都由该平台的信息服务器来中转。总体来说，整个体系是高度中心化的，使用该平台的所有设备，几乎每一步的交互操作都会有平台中心的介入，也就是有第三方的介入。

中心化物联网体系的优势有很多，成熟的物联网平台能提供更安全、更稳定的网络服务；对于常见的物联网应用场景，平台会提供方便的开发工具和模板，减少重复“造轮子”的工作量，提高开发效率。但弊端固然存在，其中最大的弊端在于，设备之间发送的所有信息实际上都经过了物联网平台服务器的中转，在信息敏感度较高的场景下，如涉及到货币交易、个人信息的场景，用户并非都能安心将自己的信息暴露给第三方；另外在一些流程较为复杂的场景，开发者更希望能对物联网的数字身份有更深度的控制权限，例如给每个数字身份绑定更丰富的信息，但在中心化的物联网身份管理体系下，数字身份相关的操作都是封装起来的，开发者无法自行控制身份管理相关的操作，每次只能向中心服务器询问、等待服务器的应答，更没有能力对数字身份添加其他信息。此外，随着物联网设备应用规模的急剧增大，中心化系统的承载能力、防灾能力也将受到极大考验。因此，物联网开发者们开始寻求去中心化的数字身份管理方案。

区块链是一种能保证自身数据不可篡改的数据结构。2009年中本聪创建的比特币网络是对区块链的第一次大规模应用。比特币网络是一种去中心化的网络体系，实际上是一个P2P网络。每个参与该网络的设备称为一个节点，节点之间使用”比特币“这一虚拟货币进行交易。每个节点都持有一套“账本”，记录着节点之间的所有交易记录，而这个所谓“账本”就是使用区块链存储的数据记录。区块链特殊的数据结构设计能保证所有节点持有的账本内容均一致，并且可以永久查询其中任意一笔交易信息。

比特币以及一众基于区块链实现的去中心化项目，让物联网开发者开始考虑使用区块链技术来实现去中心化物联网平台的可能性。区块链这一数据结构能有效保证数字身份存储的安全性，通过在区块链网络上部署智能合约，可以让每个节点都有识别身份、操作自身身份内容的能力，而无需中心化服务器的干预。所以从理论上，使用区块链技术来实现一个安全、高效的去中心化数字身份管理体系，是完全可行的。

### 研究现状

目前已经有不少基于区块链技术实现的物联网方案，不过每个方案的侧重点都有所不同。综合分析各篇文献中的实现方案，在设计和实现的过程中，需要关注的问题主要包括以下几个方面：

* 网络协议的选择：物联网常用的网络协议与互联网中常用的协议有所不同，需要根据应用场景、设备性能、并结合后续网络拓扑的设计和节点交互设计，来综合考虑选用何种网络协议；
* 网络拓扑结构的设计：根据设计方案中预期的设备规模、设备类型来确定选用何种网络拓扑结构，或是根据所选的网络协议、设备性能和功能来将不同设备划分层级，以此高效组织网络中的所有设备；
* 节点之间数据交互的逻辑设计：这一点主要与所选用的网络协议相关，例如使用MQTT协议，节点之间的数据交互是基于发布/订阅范式，也就意味着在两个节点之间还要引入一个中介(Broker)，来完成数据转发；或是经典的HTTP协议，节点之间可以直接收发数据；
* 共识协议的选用：选用合适的共识协议可以有效保障当前去中心网络中各项决策的有效性，也有利于提高决策通过的效率；
* 智能合约的设计：作为区块链读写的媒介，并且为区块链中的数据赋予实际含义；
* 智能设备的身份管理：包括数字身份的分配和鉴定，设备在进行信息交互之前都要互相鉴定对方的数字身份，数字身份的分配规则和鉴定流程就成为了整套方案的安全基础。

在立项初期所接触的文献当中，文献[2]基于MQTT协议，介绍了一种新的分布式中间件的实现方案，文中指出，一个系统内可以同时存在多个中间件，每个中间件都可充当区块链的验证节点（Validator），从而提高区块链数据验证的效率，更充分地保障数据的完整性；文献[3]提出，使用区块链和智能合约进行物联网设备的管理，每个小型私有物联网中的智能设备通过一个管理员（Manager）节点与区块链交互，智能设备本身不成为区块链节点，这个管理员节点设备将作为所在局域网内所有智能设备与区块链交互的媒介；文献[5]引入了侧链（Sidechain）的概念，设计了模块化联盟网络（Modular Consortium Network），实质是一个由诸多独立、小规模的区块链组成的更大规模的P2P网络，这样可以减轻物联网设备存储完整区块链数据结构的负担，另外还引入IPFS（Inter-Planetary File System，星际文件系统）来存储物联网设备数据，最后给出了通过智能合约来控制用户数据读取权限的方案。文献最后使用以太坊（Ethereum）[8]和Monax两种区块链平台实现了设计方案并进行性能测试，在高交易量的情况下各节点的资源消耗情况均较为乐观；文献[7]以物联网设备的固件更新作为研究案例，结合区块链网络节点和传统C/S模型，设计了一种新的物联网网络架构。

此外，除了理论模型方面的研究，区块链也有不少实际应用案例：文献[9]介绍了区块链应用于基于云端的制造业（Cloud-Based Manufacturing, CBM）的方案，block32.me使用区块链存储用户医疗信息并通过机器学习分析用户健康状况[10]，文献[11]将区块链技术应用到自动化生产中，等等。

这里罗列了几篇文献中提供的方案，并进行简单分析，这些方案在立项初期为笔者提供了丰富的理论基础，帮助笔者掌握了物联网技术与区块链技术的契合点，也带来一些初步的方案设计灵感，对后续进行项目需求分析和方案架构设计有极大帮助；在第二章将对方案中涉及到的理论基础进行详细介绍，在第三章将着重介绍和分析另外几项方案，后者为本论文的方案设计提供了更为确切的设计思路。

### 研究内容

综上，为了解决传统的中心化物联网体系中存在的问题，我们将探讨如何使用区块链技术来实现一套去中心化的物联网体系，探讨的侧重点包括以下几点：一是智能设备数字身份的管理，二是节点之间使用这套数字身份进行数据交互的逻辑设计，三是网络协议的选择和网络拓扑结构的设计。据此我们将设计一套可行的物联网数字身份管理体系，并且构建一些对应的应用场景，将设计的体系方案加以仿真实现和测试。

前文提到，在中心化的物联网体系中，设备无法对自己的数字身份有过多的操作能力。基于此，在完成初步方案的实现之后，我们还将对方案进行拓展，主要目的在于丰富数字身份的内容和功能，增加设备在数字身份操作权限方面的能力，由此提高设备与设备之间关系的灵活度，增强设备之间相互合作的能力。

### 论文结构

为了呈现方案从设计到实现的全过程，本章引言之后，本文将按照以下结构进行阐述：

第二章首先会介绍方案设计中所涉及到的各项技术和知识点，包括最基本的物联网和区块链的定义、密码学相关的知识等；

第三章将详细介绍现有的几套物联网方案，包括多项去中心化的方案，不仅在理论设计方面非常严谨，从方案实现的角度也能提供重要的参考价值；以及一项中心化方案，阿里云的物联网设备身份认证方案。阿里云是国内权威的物联网平台之一，具有代表意义，另外也会简单介绍国内其他厂商提供的物联网服务平台，不过总体来看与阿里云的方案差别不大，所以不重点讨论。

第四章将开始进行方案设计，首先会结合现有方案和实际应用场景进行需求分析，由此提出方案细节；第五章是方案实现的介绍，将重点罗列实现过程中使用到的技术栈，并展示对应功能的程序代码；第六章将介绍方案测试的流程和结果。

第七章开始将会介绍对现有设计方案的拓展，让现有方案满足更丰富的应用场景。类似地，首先会结合不同的应用场景来提出新的需求，从而进行方案升级的分析；之后将对拓展方案加以实现和测试，在第八章中呈现结果。

由于时间和能力有限，本文提出的方案固然存在不少缺陷和不足，因此在最后一章，笔者将会对整个项目进行分析总结，并提出笔者自己对该项目的期望。
